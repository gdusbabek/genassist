#!/bin/bash

# gets run as root
# bin/backup_db /tmp/genassist/gen.db /tmp/backups 5

STAMP=`date '+%Y%m%d_%H%M%S'`
DB=$1
BACKUP_DIR=$2
KEEP=$3

tar -cvzf $BACKUP_DIR/$STAMP.tgz $DB
chown node $BACKUP_DIR/$STAMP.tgz
cd $BACKUP_DIR
(ls -t $BACKUP_DIR|head -n $KEEP;ls $BACKUP_DIR) | sort | uniq -u | xargs rm